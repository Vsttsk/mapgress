# Монитор Лента

Веб-приложение для менеджеров — мониторинг торговых комплексов «Лента» на карте.

## Структура проекта

```
map-lenta/
├── index.html
├── app.js
├── style.css
├── config.js
├── server.js          # Node.js сервер для сохранения данных
├── package.json
├── stores_final.csv   # Данные ТК
├── data.json          # Данные посещений, планов, задач (создается автоматически)
└── README.md
```

## Установка и запуск

### 1. Установите Node.js (если еще не установлен)
Скачайте с https://nodejs.org/

### 2. Установите зависимости (не требуется, используется только встроенные модули Node.js)

### 3. Настройте имя пользователя (опционально)
Откройте `config.js` и измените `USER_NAME` на ваше имя:
```javascript
USER_NAME: "Саша", // или "Маша", "Иван" и т.д.
```

### 4. Запустите сервер
```bash
cd map-lenta
node server.js
```

Сервер запустится на **http://localhost:8080**

### 5. Откройте в браузере
http://localhost:8080

Пароль: **445566**

## Как это работает

### Сохранение данных
- **Все изменения сохраняются в файл `data.json`** в корне проекта
- Данные синхронизируются между всеми менеджерами через Git
- При каждом изменении (посещение, план, задача, перемещение маркера) данные автоматически сохраняются на сервер

### Синхронизация между менеджерами

**Вариант 1: Через Git (рекомендуется)**
1. Менеджер А делает изменения → сохраняется в `data.json`
2. Менеджер А делает `git add data.json && git commit -m "Обновление данных" && git push`
3. Менеджер Б делает `git pull`
4. Менеджер Б перезапускает сервер: `node server.js`
5. Менеджер Б видит изменения менеджера А

**Вариант 2: Автоматическая синхронизация (в разработке)**
- Приложение автоматически загружает данные с сервера каждые 30 секунд
- При открытии приложения данные загружаются с сервера
- Если сервер недоступен, используется LocalStorage как резерв

**Важно:** Для полной синхронизации через Git нужно коммитить `data.json` после каждого изменения.

## Функции

- **Карта** — 226 ТК с маркерами (зелёный = наш офис Максутов, синий = другие офисы, серый = нет офисов)
- **Панель ТК** — информация по клику на маркер
- **Отметка посещения** — форма с датой, присутствием офисов, комментарием
- **Статистика** — за 14 дней
- **Дашборд** — график посещений
- **Режим редактора** — перетаскивание маркеров (пароль: 445566)
- **Синхронизация** — все данные сохраняются в файл проекта

## Данные

`stores_final.csv` — формат:
- tk_number — номер ТК
- address — адрес
- lat, lng — координаты
- offices — список офисов (Максутов = наш офис)

`data.json` — формат:
```json
{
  "visits": [...],
  "tasks": [...],
  "plans": [...],
  "store_positions": [...]
}
```

## Важно

- **Всегда запускайте через `node server.js`**, а не через простой HTTP сервер
- Файл `data.json` создается автоматически при первом запуске
- Коммитьте `data.json` в Git для синхронизации между менеджерами
